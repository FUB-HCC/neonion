{% extends "base.html" %}

{% load staticfiles %}

{% block title %}Ãœbersicht{% endblock %}

{% block content %}
<div class="bg bg-20"></div>

<div class="units-row end">
    <div class="unit-20 overview-nav">
        <div class="units-row">
            <hgroup>
                <h1>NEONION</h1>
                <h3 class="subheading">rethinking Annotation</h3>
            </hgroup>
        </div>
    </div>

    <div class=" unit-push-right unit-20" id="userInfo">
        Foo Bar<br/>
        5 Documents | 3 Annotation Sets
    </div>


    <div class="unit-push-right unit-50">
        <p class="input-groups">
            <input type="text" name="go" placeholder="Search" />
            <span class="btn-append">
                <button class="btn btn-blue">Search</button>
            </span>
        </p>
    </div>


</div>

<div class="units-row">
    <div class="unit-20">
        <table class="table-simple annotator-nav">
            <tr><td><a href="/annotator"><span class="fa fa-home fa-fw"></span>My Neonion</a></td></tr>
            <tr><td><span><span class="fa fa-pencil-square-o fa-fw"></span>Annotate</span></td></tr>
            <tr><td><span><span class="fa fa-bar-chart-o fa-fw"></span>Analyze</span></td></tr>
            <tr><td><span><span class="fa fa-child fa-fw"></span>Profile</span></td></tr>
            <tr><td><span><span class="fa fa-cogs fa-fw"></span>Settings</span></td></tr>
            <tr><td><a href="{% url "auth_logout" %}?next=/"><span class="fa fa-sign-out fa-fw"></span>Logout</a></td></tr>
            <tr id="help-link"><td><span><span class="fa fa-question fa-fw"></span>Help</span></td></tr>
        </table>
    </div>

    <div class="unit-80">
    {% block right_bottom %}
        <table id="document-table" class="table-simple"><tr><td><span class="fa fa-spinner fa-spin"></span> Loading...</td></tr></table>
    {% endblock %}
    </div>

</div>
{% endblock %}


{% block scripts %}
    <script type="text/javascript" src="{% static 'js/moment.js' %}"></script>

    <script language="javascript">

    $(document).ready(function() {
        loadDocumentList(config);
    });

    function compare_Documents(a,b) {
      if (a.lastModified < b.lastModified)
         return -1;
      if (a.lastModified > b.lastModified)
        return 1;
      return 0;
    }

    function loadDocumentList(config) {
        var documentList = [];
        // load document from loomp
        jQuery.ajax({
            url: config.server + config.service.getAll + "?type=" + config.uri.elementText,
            type: 'GET',
            crossDomain: true,
            dataType: 'json'
        }).done(function(response) {
            response.forEach(function(entry) {
                documentList.push( entry );
            });
            var today = moment().startOf("day");
            var todayLabelSet = false;
            var earlierLabelSet = false;
            $('#document-table').html('<tr><td></td><td><a href="/import/">Import new Document</a></td></tr>');
            documentList.sort( compare_Documents ).reverse().forEach( function( entry ) {
                /* set label for first column (only once for each type) */
                var label = '';
                if( !todayLabelSet && entry.lastModified >= today ){
                    label = 'Today';
                    todayLabelSet = true;
                }
                if( !earlierLabelSet && entry.lastModified < today ){
                    label = 'Earlier';
                    earlierLabelSet = true;
                }
                /* create element for document list and append it */
                var uri = entry.uri.split("/")
                var id = uri[uri.length-1]
                var element = $('<tr></tr>')
                    .append( $('<td></td>').text( label ) ) // add label (today or earlier)
                    .append($('<td class="element-cell"></td>')
                        .append($('<a href="/annotator/' + id + '">' + entry.title + '</a>'))
                        .append($('<div class="document-list-buttons"></div>')
                            .append('<span class="fa fa-info-circle fa-fw" title="info"></span>')
                            .append('<span class="fa fa-trash-o fa-fw" title="delete"></span>')
                        )
                    );
                $('#document-table').append( element );
            });
        });



    }

    </script>
{% endblock %}