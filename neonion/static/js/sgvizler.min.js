// Sgvizler - https://dev.data2000.no/sgvizler/
// (c) 2011--2013 - Martin G. Skj√¶veland - MIT license
(function(e,t){"use strict";var n=e.document,r={},i,s,o;r.core=function(){var e="0.6.0",t="http://dev.data2000.no/sgvizler/",n="http://beta.data2000.no/sgvizler/misc/image/mr.sgvizler.png",r="http://beta.data2000.no/sgvizler/release/0.6/sgvizler.charts.css";return{VERSION:e,HOMEPAGE:t,LOGOIMAGE:n,CHARTSCSS:r}}(),r.util=function(){var r=function(e){return typeof e=="string"},i=function(e){return typeof e=="number"},s=function(e){return typeof e=="boolean"},o=function(e){return r(e)||i(e)||s(e)},u=$.isFunction,a=$.isArray,f=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i"),l=function(e){return f.test(e)},c=function(){var e=function(){};return function(t,n){e.prototype=n.prototype,t.prototype=new e,t.prototype.constructor=t}}(),h=function(e,n,r,i){return n!==t&&(r[e]=n),n!==t?i:r[e]},p=function(e,t){return e.lastIndexOf(t,0)===0},d=function(n,r,i){var s,o,u=n.split("."),a=r||e;for(s=0,o=u.length;s<o;s+=1)a!==t&&a[u[s]]===t&&i&&(a[u[s]]={}),a=a&&a[u[s]];return a},v=function(e,t){return $.inArray(e,t)!==-1},m=function(e){var t,n,r=[];for(t=0,n=e.length;t<n;t+=1)v(e[t],r)||r.push(e[t]);return r},g=function(e){var n;if(e===t)n=[];else if(o(e))n=[e];else{if(!a(e))throw new TypeError;n=e}return n},y=function b(e,r,i){var s,u,f=$(n.createElement(e)),l,c=g(i),h;for(l in r)r.hasOwnProperty(l)&&f.attr(l,r[l]);for(s=0,u=c.length;s<u;s+=1){h=c[s];if(o(h))f.append(h);else{if(!a(h))throw new TypeError;f.append(b.apply(t,h))}}return f};return{isString:r,isNumber:i,isBoolean:s,isPrimitive:o,isFunction:u,isArray:a,isURL:l,startsWith:p,isInArray:v,toArray:g,removeDuplicates:m,getObjectByPath:d,getset:h,inherit:c,createHTMLElement:y}}(),r.namespace=function(){var e=r.util.startsWith,t=r.util.isString,n={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",xsd:"http://www.w3.org/2001/XMLSchema#"},i=null;return{get:function(e){return n[e]},set:function(e,t){n[e]=t},getBaseURL:function(){return i},setBaseURL:function(e){i=e},prefixesSPARQL:function(){var e,t="";for(e in n)n.hasOwnProperty(e)&&(t+="PREFIX "+e+": <"+n[e]+">\n");return t},prefixify:function(r){var i;if(t(r))for(i in n)if(n.hasOwnProperty(i)&&e(r,n[i]))return r.replace(n[i],i+":");return r},unprefixify:function(r){var i;if(t(r))for(i in n)if(n.hasOwnProperty(i)&&e(r,i+":"))return r.replace(i+":",n[i]);return r}}}(),r.registry=function(){var e=r.util,n="google.visualization",i=n+".DataTable",s="google.maps",o={chart:[n],datatable:[]},u={google:{visualization:{DataTable:{t:"core",d:{i:n}},LineChart:{d:{i:"corechart"}},AreaChart:{d:{i:"corechart"}},SteppedAreaChart:{d:{i:"corechart"}},PieChart:{d:{i:"corechart"}},BubbleChart:{d:{i:"corechart"}},ColumnChart:{d:{i:"corechart"}},BarChart:{d:{i:"corechart"}},ImageSparkLine:{d:{i:"imagesparkline"}},ScatterChart:{d:{i:"corechart"}},CandlestickChart:{d:{i:"corechart"}},Gauge:{d:{i:"gauge"}},OrgChart:{d:{i:"orgchart"}},TreeMap:{d:{i:"treemap"}},AnnotatedTimeLine:{d:{i:"annotatedtimeline"}},MotionChart:{d:{i:"motionchart"}},GeoChart:{d:{i:"geochart"}},GeoMap:{d:{i:"geomap"}},Map:{d:{i:"map"}},Table:{d:{i:"table"}}},maps:{Map:{d:{i:"map"}}}}};return{GVIZ:n,GMAP:s,DATATABLE:i,chartModules:function(){return o.chart},chartFunctions:function(){var n,r,i=o.chart,s,a,f=[];for(n=0,r=i.length;n<r;n+=1){s=e.getObjectByPath(i[n],u);for(a in s)s.hasOwnProperty(a)&&(s[a].t===t||s[a].t==="chart")&&f.push(i[n]+"."+a)}return f},getDependencies:function(t){var n=e.getObjectByPath(t,u),r=n&&n.d||{};return r.i&&(r[t]=r.i,delete r.i),r},addFunction:function(t,n,r,i){var s;e.isInArray(t,o[r])||o[r].push(t),s=e.getObjectByPath(t+"."+n,u,!0),r&&(s.t=r),i&&(s.d=i)}}}(),r.logger=function(){var e=Date.now(),t=function(){return(Date.now()-e)/1e3},n=0;return{log:function(e){console.log(t()+"s: "+e)},loadingChart:function(){n+=1,$("body,html").css("cursor","progress")||$("body,html").css("cursor","progress")},doneLoadingChart:function(){n-=1,n===0&&$("body,html").css("cursor","progress")&&$("body,html").css("cursor","default")}}}(),r.charts=function(){var e=r.util.inherit,t=r.registry.addFunction,n,i=function(r,i,s,o){var u=function(e){n.call(this,e)};return e(u,n),u.prototype.draw=s,t(r,i,"chart",o),u};return n=function(){var e=function(e){this.container=e,this.listeners={}};return e.prototype={addListener:function(e,t){if(typeof t!="function")throw new TypeError;this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t)},fireListener:function(e){if(this.listeners[e])while(this.listeners[e].length)this.listeners[e].pop()()}},e}(),{add:i}}(),r.datatables=function(){var e=r.registry.addFunction,t=function(t,n,r,i){return e(t,n,"datatable",i),r};return{add:t}}(),r.parser=function(){var e=r.namespace,n=function(){var t=e.get("xsd"),n=[];return n[t+"float"]="number",n[t+"decimal"]="number",n[t+"int"]="number",n[t+"integer"]="number",n[t+"long"]="number",n[t+"boolean"]="boolean",n[t+"date"]="date",n[t+"dateTime"]="datetime",n[t+"time"]="timeofday",n}(),i=function(e){return n[e]||"string"},s=function(t,n,r){var i;return n==="number"?i=Number(t):n==="date"?i=new Date(t.substr(0,4),t.substr(5,2),t.substr(8,2)):n==="datetime"?i=new Date(t.substr(0,4),t.substr(5,2),t.substr(8,2),t.substr(11,2),t.substr(14,2),t.substr(17,2)):n==="timeofday"?i=[t.substr(0,2),t.substr(3,2),t.substr(6,2)]:(r==="uri"&&(i=e.prefixify(t)),i=t),i};return{convertXML:function(e){var t,n,r,o=[],u=[],a=[],f=$(e).find("sparql").find("results").find("result");return t=0,$(e).find("sparql").find("head").find("variable").each(function(){var e=null,n=$(this).attr("name"),r=null,s=$(f).find('binding[name="'+n+'"]');s.length&&(r=$(s).first().children().first()[0],e=$(r).attr("datatype")),a[t]=i(e),o[t]={id:n,label:n,type:a[t]},t+=1}),r=0,$(f).each(function(){var e,i,f,l,h,p=[];for(t=0,n=o.length;t<n;t+=1)e=null,i=$(this).find('binding[name="'+o[t].id+'"]'),i.length&&$(i).first().children().first()&&$(i).first().children().first()[0]&&(f=$(i).first().children().first()[0],l=f.nodeName,h=$(f).first().text(),e=s(h,a[t],l)),p[t]={v:e};u[r]={c:p},r+=1}),{cols:o,rows:u}},convertJSON:function(e){var n,r,o,u,a,f,l,c,h=[],p=[],d=[],v=e.head.vars,m=e.results.bindings;for(n=0,r=v.length;n<r;n+=1){o=0;while(o+1<m.length&&m[o][v[n]]===t)o+=1;c=m[o]&&m[o][v[n]]&&m[o][v[n]].datatype||null,d[n]=i(c),h[n]={id:v[n],label:v[n],type:d[n]}}for(o=0,u=m.length;o<u;o+=1){a=m[o],f=[];for(n=0,r=v.length;n<r;n+=1)l=null,a[v[n]]&&a[v[n]].value&&(l=s(a[v[n]].value,d[n],a[v[n]].type)),f[n]={v:l};p[o]={c:f}}return{cols:h,rows:p}},countXML:function(e){return $(e).find("sparql").find("results").find("result").length},countJSON:function(e){return e.results.bindings&&e.results.bindings.length}}}(),r.loader=function(){var e=r.util,n=r.logger,i=r.registry,s=i.GVIZ,o=i.GMAP,u={},a=function(t,r){var i,o={},a=e.removeDuplicates(t).sort(),f;if(a.length||r)i=$.Deferred(),f={callback:function(){i.resolve(),u[s].resolve(),n.log("loadGVizScript: packages LOADED: "+a)}},a.length&&(f.packages=a),google.load("visualization","1",f),n.log("loadGVizScript: loading packages: "+a),o=i.promise();return o},f=function(){var e=$.Deferred(),t={other_params:"sensor=false",callback:function(){e.resolve(),n.log("loadGVizScript: google.maps. LOADED: ")}};return google.load("maps","3",t),n.log("loadGMapScript: loading google.maps."),e.promise()},l=function(r){var l,c,h,p=[],d=[],v,m,g,y;r=e.removeDuplicates(e.toArray(r));while(r.length){h=r.pop(),m=i.getDependencies(h);for(g in m)m.hasOwnProperty(g)&&(u[m[g]]?p.push(u[m[g]]):e.getObjectByPath(g)===t&&(e.startsWith(g,s)?g===i.DATATABLE?(y=!0,u[m[g]]=$.Deferred()):d.push(m[g]):e.startsWith(g,o)?(u[m[g]]=f(),p.push(u[m[g]]),n.log("loadDependencies: loading script: "+m[g])):(u[m[g]]=$.getScript(m[g]).done(function(){n.log("loadDependencies: loaded: "+m[g])}),p.push(u[m[g]]),n.log("loadDependencies: loading script: "+m[g]))))}if(d.length||y){v=a(d,y),p.push(v);for(l=0,c=d.length;l<c;l+=1)u[d[l]]=v}return $.when.apply($,p)};return{loadDependencies:l}}(),r.defaults=function(){var e=r.registry.GVIZ,t={query:"SELECT ?class (count(?instance) AS ?noOfInstances)\nWHERE{ ?instance a ?class }\nGROUP BY ?class\nORDER BY ?class",froms:[],endpoint:"http://sws.ifi.uio.no/sparql/world",endpoint_output_format:"json",endpoint_results_urlpart:"?output=text&amp;query=",validator_url:"http://sparql.org/validate/query?languageSyntax=SPARQL&amp;outputFormat=sparql&amp;linenumbers=true&amp;query=",chart:e+".Table",loglevel:2},n={width:800,height:400,chartArea:{left:"5%",top:"5%",width:"75%",height:"80%"}},i=function(){var t={};return t[e+".GeoMap"]={dataMode:"markers"},t[e+".Map"]={dataMode:"markers"},t[e+".Sparkline"]={showAxisLines:!1},t}();return{query:t,chart:n,getQueryOptions:function(){return $.extend({},t)},getChartOptions:function(){return $.extend({},n)},getChartSpecificOptions:function(e){return $.extend({},i[e])},setChartSpecificOption:function(e,t,n){i[e]=i[e]||{},i[e][t]=n}}}(),r.Query=function(i,s){var o=r.util,u=o.getset,a=r.namespace.prefixesSPARQL,f=r.registry,l=f.GVIZ,c=f.DATATABLE,h=r.parser,p=r.loader.loadDependencies,d=r.logger,v=r.defaults,m="xml",g="json",y="jsonp",b,w,E={},x,T,N,C=function(e){b.froms.push(e)},k=function(){b.froms=[]},L=function(e){return e!==t&&k(),u("query",e,b,this)},A=function(e){return u("endpoint",e,b,this)},O=function(e){return u("endpoint_output_format",e,b,this)},M=function(e){return u("endpoint_results_urlpart",e,b,this)},_=function(e){return u("validator_url",e,b,this)},D=function(e){return u("loglevel",e,b,this)},P=function(e){return u("logContainer",e,b,this)},H=function(e){return u("datatable",e,b,this)},B=function(e){return u("chart",e,b,this)},j=function(e){return u("height",e,w,this)},F=function(e){return u("width",e,w,this)},I=function(){return encodeURIComponent(a()+L())},q=function(){var e,t=b.froms.length,n;if(t){n="";for(e=0;e<t;e+=1)n+="FROM <"+b.froms[e]+">\n";L(L().replace(/((WHERE)?(\s)*\{)/i,"\n"+n+"$1"))}},R=function(e){return N===t&&(O()===m?N=h.countXML(e):N=h.countJSON(e)),N},U=function(e){var t={};return R(e)&&(O()===m?t=h.convertXML(e):t=h.convertJSON(e)),t},z=function(e,t){if(typeof t!="function")throw new TypeError;E[e]=E[e]||[],E[e].push(t)},W=function(e){if(E[e])while(E[e].length)E[e].pop()()},X=function(){var t,n=O();return q(),n!==y&&e.XDomainRequest?t=function(){var e=$.Deferred(),t=new XDomainRequest,r=A()+"?query="+I()+"&output="+n;return t.open("GET",r),t.onload=function(){var r;n===m?r=$.parseXML(t.responseText):r=$.parseJSON(t.responseText),e.resolve(r)},t.send(),e.promise()}():t=$.ajax({url:A(),data:{query:a()+L(),output:n===y?g:n},dataType:n}),t},V=function(){var e;return T!==t?e=T:(e=X(),e.fail(function(e,t,n){d.log("Error: A '"+t+"' occurred in Query.saveQueryResults()"),W("onFail")}),e.done(function(e){T=e,W("onDone")})),e},J=function(){var e,t=H();return x?e=x:e=$.when(V(),p(c),function(){var e={};return t&&(e=p(t)),e}()).done(function(){x=new google.visualization.DataTable(U(T));if(t){var e=o.getObjectByPath(t);x=e(x)}}),e},K=function(e){var t=B();$.when(J(),p(t)).then(function(){try{var r=o.getObjectByPath(t),i=new r(n.getElementById(e)),s=function(){d.log(t+" for "+e+" is ready."),W("onDraw")};o.startsWith(t,l)?google.visualization.events.addListener(i,"ready",s):i.addListener&&i.addListener("ready",s),i.draw(x,w)}catch(u){d.log(t+" -- "+u)}})};b=$.extend(v.getQueryOptions(),i),w=$.extend(v.getChartOptions(),v.getChartSpecificOptions(B()),s);if(this instanceof r.Query)return{noOfResults:N,draw:K,getEncodedQuery:I,onFail:function(e){z("onFail",e)},onDone:function(e){z("onDone",e)},onDraw:function(e){z("onDraw",e)},getDataTable:function(e,t){$.when(J()).then(function(){var t=x.clone();e(t)},function(){var e=x.clone();t(e)})},addFrom:C,clearFroms:k,query:L,endpointURL:A,endpointOutputFormat:O,endpointResultsURLPart:M,validatorURL:_,loglevel:D,logContainer:P,datatableFunction:H,chartFunction:B,chartHeight:j,chartWidth:F};throw new Error("Constructor 'Query' called as a function. Use 'new'.")},r.container=function(){var e=r.util,i=r.loader.loadDependencies,s=r.logger,o=r.Query,u="data-sgvizler-",a=u+"chart-options",f="=",l="|",c=function(t){var r,i,s={},o=n.getElementById(t).attributes;for(r=0,i=o.length;r<i;r+=1)e.startsWith(o[r].name,u)&&(s[o[r].name.substring(u.length)]=o[r].value);return s},h=function(e){var n,r,i,s,o,u,c,h,p={},d=$("#"+e).attr(a);if(d!==t){o=d.split(l);for(n=0,i=o.length;n<i;n+=1){u=o[n].split(f),c=u[0].split("."),h=p;for(r=0,s=c.length-1;r<s;r+=1)h[c[r]]===t&&(h[c[r]]={}),h=h[c[r]];h[c[r]]=u[1]}}return p.width=/(\d+)/.exec($("#"+e).css("width"))[1],p.height=/(\d+)/.exec($("#"+e).css("height"))[1],p},p=function(t){t=e.toArray(t),$("["+u+"chart]").each(function(){t.push($(this).attr(u+"chart"))}),s.log("initializer: loading functions: "+t),i(t)},d=function(e){var t=c(e),n=h(e),r=t.rdf&&t.rdf.split(l)||[],i=new o(t,n);while(r.length)i.addFrom(r.pop());s.log("drawing id: "+e),i.draw(e)},v=function(){p(),$("["+u+"query]").each(function(){d($(this).attr("id"))})};return{draw:d,drawAll:v}}(),r.form=function(){var i=r.util,s=r.namespace.prefixesSPARQL,o=r.registry,u=r.Query,a="sgvzlr_",f=a+"mainCon",l=a+"formCon",c=a+"gchart",h=a+"formQuery",p=a+"cQuery",d=a+"strQuery",v=a+"strEndpointGrp",m=a+"strEndpoint",g=a+"btnFormatGrp",y=a+"btnFormat",b=a+"strSizeGrp",w=a+"strWidth",E=a+"strHeight",x=a+"optChartGrp",T=a+"optChart",N=a+"btnSendGrp",C=a+"cPrefix",k=a+"cMessage",L=a+"logo",A=a+"footer",O=function(){return{heading:["h1",null,["Sgvizler"]],logo:["div",{id:L},[["a",{href:r.core.HOMEPAGE},[["img",{src:r.core.LOGOIMAGE,alt:"Mr. Sgvizler"}]]],"Mr. Sgvizler"]],main:["div",{id:l},[["pre",{id:C}],["textarea",{id:p,rows:"10",cols:"80"}],["form",{id:h,method:"get"},[["p",null,[["input",{id:d,type:"hidden",name:"query",value:""}],["span",{id:v},[["label",{"for":m},["Endpoint: "]],["input",{id:m,type:"text",name:"endpoint",size:"30"}]]],["span",{id:g},[["label",{"for":y},["Output format: "]],["input",{id:y,type:"radio",name:"endpoint_output",value:"xml"}],"xml ",["input",{id:y,type:"radio",name:"endpoint_output",value:"json"}],"json ",["input",{id:y,type:"radio",name:"endpoint_output",value:"jsonp"}],"jsonp"]],["span",{id:x},[["label",{"for":T},["Chart type: "]],["select",{id:T,name:"chart"}]]],["span",{id:b},[["label",{"for":w},["Width: "]],["input",{id:w,name:"width",type:"text",size:"3"}],["label",{"for":E},["Height: "]],["input",{id:E,name:"height",type:"text",size:"3"}]]],["span",{id:N},[["input",{type:"button",value:"Reset",onclick:"sgvizler.formReset()"}],["input",{type:"button",value:"Go",onclick:"sgvizler.formSubmit()"}]]]]]]],["div",{id:k}]]],chart:["div",{id:c,style:"width:800px; height:400px;"}],footer:["div",{id:A},[["p",null,[["a",{href:r.core.HOMEPAGE},["Sgvizler"]]," version "+r.core.VERSION+" (c) 2011&ndash;2013 Martin G. Skj&#230;veland."]]]]}}(),M=["query","endpoint","endpoint_output","chart","width","height","ui"],_=function(e){return $("#"+e).length>0},D=function(e,t){_(e)&&$("#"+e).val(t)},P=function(e,t){_(e)&&$("#"+e).text(t)},H=function(){P(C,s())},B=function(e){D(p,e.query()),D(m,e.endpointURL()),$("input:radio[id="+y+"][value="+e.endpointOutputFormat()+"]").attr("checked",!0),D(T,e.chartFunction()),D(w,e.chartWidth()),D(E,e.chartHeight())},j=function(){var e,t,n,r,s=o.chartFunctions().sort(),u=function(e){return i.createHTMLElement("optgroup",{label:e+".*"})},a=o.chartModules(),f={},l=!1;if(_(T)){for(t=0,r=a.length;t<r;t+=1)f[a[t]]=u(a[t]),$("#"+T).append(f[a[t]]);for(e=0,n=s.length;e<n;e+=1){l=!1;for(t=0,r=a.length;t<r;t+=1)i.startsWith(s[e],a[t])&&($(f[a[t]]).append($("<option/>").val(s[e]).html(s[e].replace(a[t]+".",""))),l=!0);l||$("#"+T).append($("<option/>").val(s[e]).html(s[e]))}}},F=function(e,n){var r=function(e){return i.createHTMLElement.apply(t,e)},s=function(e){e?c=e:$("body").append(r(O.chart))},o=function(e){var t;e?t=$("#"+e):(t=i.createHTMLElement("div",{id:f}),$("body").append(r(O.logo),r(O.heading),t,r(O.footer))),t.append(r(O.main),r(O.chart))};n==="result"?s(e):o(e)},I=function(e){H(),j(),B(e)},q=function(t){var n={},r,s=/([^&=]+)=?([^&]*)/g,o=function(e){return decodeURIComponent(e.replace(/\+/g," "))},u=e.location.search.substring(1),a=t||M;while((r=s.exec(u))!==null)r[2].length>0&&i.isInArray(r[1],a)&&(n[o(r[1])]=o(r[2]));return n},R=function(){n.location=e.location.href.replace(e.location.search,"")},U=function(){$("#"+d).val($("#"+p).val()),$("#"+h).submit()},z=function(e){var t=q(),n=new u({query:t.query,chart:t.chart,endpoint:t.endpoint,endpoint_output:t.endpoint_output},{width:t.width,height:t.height});F(e,t.ui),I(n),_(c)&&t.query&&(n.logContainer(k),n.draw(c))};return{draw:z,reset:R,submit:U}}(),r.visualization=function(){var n=r.util,i=r.namespace,s=r.charts,o={},u="sgvizler.visualization";return o.D3ForceGraph=s.add(u,"D3ForceGraph",function(e,n){var r,i=e.getNumberOfRows(),s,u,a=e.getNumberOfColumns(),f=$.extend({maxnodesize:15,minnodesize:2},n),l=d3.scale.category20(),c=n.width,h=n.height,p=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},d=[],v=[],m={},g={},y=0,b,w,E,S,x,T,N,k,L,A;o.util.loadCSS();for(r=0;r<i;r+=1)b=e.getValue(r,0),w=e.getValue(r,1),b!==null&&$.inArray(b,d)===-1&&(d.push(b),g[b]=a>2?Math.sqrt(e.getValue(r,2)):0,m[b]=a>3?e.getValue(r,3):0,g[b]>y&&(y=g[b])),w!==null&&$.inArray(w,d)===-1&&d.push(w),b!==null&&w!==null&&v.push({source:$.inArray(b,d),target:$.inArray(w,d)});y===0&&(y=1),E=f.maxnodesize/y;for(s=0,u=d.length;s<u;s+=1)S=m[d[s]]!==t?m[d[s]]:1,x=p(g[d[s]])?f.minnodesize+g[d[s]]*E:f.minnodesize,d[s]={name:d[s],color:S,size:x};$(this.container).empty(),T=d3.select(this.container).append("svg:svg").attr("width",c).attr("height",h).attr("pointer-events","all").append("svg:g").call(d3.behavior.zoom().on("zoom",function(){T.attr("transform","translate("+d3.event.translate+")"+" scale("+d3.event.scale+")")})).append("svg:g"),T.append("svg:rect").attr("width",c).attr("height",h).attr("fill","white"),N=d3.layout.force().gravity(.05).distance(100).charge(-100).nodes(d).links(v).size([c,h]).start(),k=T.selectAll("line.link").data(v).enter().append("svg:line").attr("class","link").attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),L=T.selectAll("g.node").data(d).enter().append("svg:g").attr("class","node").call(N.drag),L.append("svg:circle").style("fill",function(e){return l(e.color)}).attr("class","node").attr("r",function(e){return e.size}),L.append("svg:title").text(function(e){return e.name}),L.append("svg:text").attr("class","nodetext").attr("dx",12).attr("dy",".35em").text(function(e){return e.name}),A=0,N.on("tick",function(){A+=1,A>250&&(N.stop(),N.charge(0).linkStrength(0).linkDistance(0).gravity(0).start()),k.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),L.attr("transform",function(e){return"translate("+e.x+","+e.y+")"})}),this.fireListener("ready")},{d3:"//cdnjs.cloudflare.com/ajax/libs/d3/2.10.0/d3.v2.min.js"}),o.DefList=s.add(u,"DefList",function(e,t){var n,r=e.getNumberOfRows(),i,s=e.getNumberOfColumns(),u=$.extend({cellSep:" ",termPrefix:"",termPostfix:":",definitionPrefix:"",definitionPostfix:""},t),a="",f,l;for(n=0;n<r;n+=1){f="<dt>"+u.termPrefix+o.util.linkify2String(e.getValue(n,0))+u.termPostfix+"</dt>",l="<dd>"+u.definitionPrefix;for(i=1;i<s;i+=1)l+=o.util.linkify2String(e.getValue(n,i)),i+1!==s&&(l+=u.cellSep);l+=u.definitionPostfix+"</dd>",a+=f+l}$(this.container).empty().html(a),this.fireListener("ready")}),o.DraculaGraph=s.add(u,"DraculaGraph",function(n,r){var s,o=n.getNumberOfRows(),u,a,f=n.getNumberOfColumns(),l=$.extend({noderadius:.5,nodefontsize:"10px",nodeheight:20,nodestrokewidth:"1px",directed:!1,nodecornerradius:"1px",nodepadding:7,nodecolor:"green",edgestroke:"blue",edgefill:"blue",edgestrokewidth:1,edgefontsize:"10px",edgeseparator:", "},r),c=new Dracula.Graph,h,p,d,v,m,g,y=function(t,n){return function(r,s){return r.set().push(r.rect(s.point[0],s.point[1],s.label.length*l.nodepadding,l.nodeheight).attr({fill:t,"stroke-width":l.nodestrokewidth,r:l.nodecornerradius})).push(r.text(s.point[0]+s.label.length*l.nodepadding/2,s.point[1]+l.nodeheight/2,s.label).attr({"font-size":l.nodefontsize}).click(function(){n&&e.open(i.unprefixify(n))}))}},b=function(e,t,n){c.addNode(e,{label:t,render:y(n,e)})},w={},E=[];for(s=0;s<o;s+=1)v=n.getValue(s,0),m=n.getValue(s,2),v&&b(v,n.getValue(s,1)||v,f>5?n.getValue(s,5):l.nodecolor),m&&b(m,n.getValue(s,3)||m,f>6?n.getValue(s,6):l.nodecolor),v&&m&&(g="",w[v+m]!==t?g=w[v+m].label:E.push(v+m),f>4&&n.getValue(s,4).length>0&&(g.length>0&&(g+=l.edgeseparator),g+=n.getValue(s,4)),w[v+m]={source:v,target:m,label:g});for(u=0,a=E.length;u<a;u+=1)d=w[E[u]],c.addEdge(d.source,d.target,{stroke:l.edgestroke,directed:l.directed,fill:l.edgefill,label:d.label,width:l.edgestrokewidth,fontsize:l.edgefontsize});h=new Dracula.Graph.Layout.Spring(c),h.layout(),$(this.container).empty(),p=new Dracula.Graph.Renderer.Raphael(this.container,c,l.width,l.height,{noderadius:l.nodeheight*l.noderadius}),p.draw(),this.fireListener("ready")},{Dracula:"http://www.data2000.no/sgvizler/lib/raphael-dracula.min.js"}),o.List=s.add(u,"List",function(e,t){var n,r=e.getNumberOfColumns(),i,s=e.getNumberOfRows(),u=$.extend({list:"ul",cellSep:", ",rowPrefix:"",rowPostfix:""},t),a="<"+u.list+">";for(i=0;i<s;i+=1){a+="<li>"+u.rowPrefix;for(n=0;n<r;n+=1)a+=o.util.linkify2String(e.getValue(i,n)),n+1!==r&&(a+=u.cellSep);a+=u.rowPostfix+"</li>"}a+="</"+u.list+">",$(this.container).empty().html(a),this.fireListener("ready")}),o.Map=s.add(u,"Map",function(e,t){var n,r=e.getNumberOfColumns(),s,u=e.getNumberOfRows(),a=this,f=$.extend({dataMode:"markers",showTip:!0,useMapTypeControl:!0},t),l,c,h;o.util.loadCSS();if(r>3){c=e.clone();for(n=r-1;n>2;n-=1)c.removeColumn(n);for(s=0;s<u;s+=1)h="<div class='sgvizler sgvizler-sMap'>",h+="<h1>"+e.getValue(s,2)+"</h1>",5<r&&e.getValue(s,5)!==null&&(h+="<div class='img'><img src='"+e.getValue(s,5)+"'/></div>"),3<r&&e.getValue(s,3)!==null&&(h+="<p class='text'>"+e.getValue(s,3)+"</p>"),4<r&&e.getValue(s,4)!==null&&(h+="<p class='link'><a href='"+i.unprefixify(e.getValue(s,4))+"'>"+e.getValue(s,4)+"</a></p>"),h+="</div>",c.setCell(s,2,h)}else c=e;l=new google.visualization.Map(this.container),l.draw(c,f),google.visualization.events.addListener(l,"ready",function(){a.fireListener("ready")})},{"google.visualization.Map":"map"}),o.MapWKT=s.add(u,"MapWKT",function(e,t){var r=e.getNumberOfColumns(),i,s=e.getNumberOfRows(),u=$.extend({zoom:5,centerLat:62,centerLong:2,geoDatumIn:"EPSG:4326",geoDatumOut:"EPSG:4326"},t),a={projection:u.geoDatumOut,layers:[new OpenLayers.Layer.OSM,new OpenLayers.Layer.Google("Google Physical",{type:google.maps.MapTypeId.TERRAIN}),new OpenLayers.Layer.Google("Google Streets",{numZoomLevels:20}),new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,numZoomLevels:20}),new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE,numZoomLevels:22})],controls:[new OpenLayers.Control.Navigation,new OpenLayers.Control.PanZoomBar,new OpenLayers.Control.LayerSwitcher({ascending:!1}),new OpenLayers.Control.Permalink,new OpenLayers.Control.ScaleLine,new OpenLayers.Control.MousePosition,new OpenLayers.Control.OverviewMap,new OpenLayers.Control.KeyboardDefaults],center:new OpenLayers.LonLat(u.centerLong,u.centerLat),zoom:5},f,l=new OpenLayers.Map(this.container,a),c=new OpenLayers.Format.WKT({internalProjection:l.baseLayer.projection,externalProjection:new OpenLayers.Projection(u.geoDatumIn)}),h=new OpenLayers.Layer.Vector("Results",{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({fillColor:"#33CC00",fillOpacity:.2,strokeColor:"#000000",strokeWidth:1})})}),p=new OpenLayers.Layer.Vector("Labels",{eventListeners:{featureselected:function(e){var t=e.feature,n=new OpenLayers.Popup.FramedCloud("popup",OpenLayers.LonLat.fromString(t.geometry.toShortString()),null,"<div style='font-size:.8em'><b>"+t.attributes.name+"</b><br/>"+o.util.linkify2String(t.attributes.uri)+"<br/>"+t.attributes.description+"</div>",null,!0);t.popup=n,l.addPopup(n)},featureunselected:function(e){var t=e.feature;l.removePopup(t.popup),t.popup.destroy(),t.popup=null}},styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({strokeColor:"#FF0000",strokeOpacity:1,strokeWidth:5,fillColor:"#FF0000",fillOpacity:.5,pointRadius:2,label:"${name}",fontSize:"10px",fontFamily:"Arial",labelAlign:"l",labelOutlineColor:"white",labelOutlineWidth:1,labelXOffset:7})})}),d=new OpenLayers.Control.SelectFeature(p,{click:!0,autoActivate:!0}),v,m,g=function(e,t){var r=c.read(t),i;if(r){n.isArray(r.constructor)||(r=[r]);for(i=0;i<r.length;i+=1)f?f.extend(r[i].geometry.getBounds()):f=r[i].geometry.getBounds();e.addFeatures(r)}return r};for(i=0;i<s;i+=1)v=g(h,e.getValue(i,0)),m=new OpenLayers.Feature.Vector(v[0].geometry.getCentroid()),m.attributes.name=r>1&&e.getValue(i,1)?e.getValue(i,1):"",m.attributes.uri=r>2&&e.getValue(i,2)?e.getValue(i,2):"",m.attributes.description=r>3&&e.getValue(i,3)?e.getValue(i,3):"",p.addFeatures([m]);l.addLayer(h),l.addLayer(p),l.addControl(d),l.zoomToExtent(f),this.fireListener("ready")},{"google.maps.Map":"google.maps.Map",OpenLayers:"//cdnjs.cloudflare.com/ajax/libs/openlayers/2.12/OpenLayers.min.js"}),o.Table=s.add(u,"Table",function(e,t){var r,i=e.getNumberOfColumns(),s,u=e.getNumberOfRows(),a=$.extend({headings:!0},t),f,l=[],c=[];if(a.headings){for(r=0;r<i;r+=1)c.push(["th",null,e.getColumnLabel(r)]);l.push(["tr",null,c])}for(s=0;s<u;s+=1){c=[];for(r=0;r<i;r+=1)c.push(["td",null,[o.util.linkify2HTMLElementArray(e.getValue(s,r))]]);l.push(["tr",null,c])}f=n.createHTMLElement("table",null,l),$(this.container).empty().html(f),this.fireListener("ready")}),o.Text=s.add(u,"Text",function(e,t){var n,r=e.getNumberOfColumns(),i,s=e.getNumberOfRows(),u=$.extend({cellSep:", ",cellPrefix:"",cellPostfix:"",rowPrefix:"<p>",rowPostfix:"</p>",resultsPrefix:"<div>",resultsPostfix:"</div>"},t),a=u.resultsPrefix,f;for(i=0;i<s;i+=1){f=u.rowPrefix;for(n=0;n<r;n+=1)f+=u.cellPrefix+o.util.linkify2String(e.getValue(i,n))+u.cellPostfix,n+1!==r&&(f+=u.cellSep);a+=f+u.rowPostfix}a+=u.resultsPostfix,$(this.container).empty().html(a),this.fireListener("ready")}),o.util=function(){var e=function(e,t){var n=i.prefixify(e),s=i.getBaseURL,o=e,u,a;return n!==e?u=n:r.util.isURL(e)&&(u=e),u?(s&&(o=s+e),t?a=["a",{href:o},u]:a="<a href="+o+">"+u+"</a>"):a=e,a},t=!1;return{linkify2String:function(t){return e(t,!1)},linkify2HTMLElementArray:function(t){return e(t,!0)},loadCSS:function(){t||($("head").append('<link rel="stylesheet" href="'+r.core.CHARTSCSS+'" type="text/css" />'),t=!0)}}}(),o}(),r.datatable=function(){var e=r.namespace,t=r.datatables,n={},i="sgvizler.datatable";return n.pivot=t.add(i,"pivot",function(e){var t=e.getDistinctValues(0),n=new google.visualization.DataView(e),r=t.map(function(e){return{type:"number",label:e,calc:function(t,n){return t.getValue(n,0)===e?t.getValue(n,2):null}}}),i=t.map(function(e,t){return{column:t+1,type:"number",label:e,aggregation:google.visualization.data.sum}});return r.unshift(1),n.setColumns(r),google.visualization.data.group(n,[0],i)}),n.prefixify=t.add(i,"prefixify",function(t){var n,r=t.getNumberOfColumns(),i,s=t.getNumberOfRows();for(n=0;n<r;n+=1)if(t.getColumnType(n)==="string")for(i=0;i<s;i+=1)t.setValue(i,n,e.prefixify(t.getValue(i,n)));return t}),n}(),i=r.util.getset,s=r.defaults.query,o=r.defaults.chart;if(e.sgvizler)throw new Error("Javascript module 'sgvizler' already exists.");e.sgvizler={VERSION:r.core.VERSION,HOMEPAGE:r.core.HOMEPAGE,chartsAdd:r.charts.add,datatablesAdd:r.datatables.add,registryChartFunctions:r.registry.chartFunctions,namespacePrefixesSPARQL:r.namespace.prefixesSPARQL,namespacePrefixify:r.namespace.prefixify,namespaceUnprefixify:r.namespace.unprefixify,containerDraw:r.container.draw,containerDrawAll:r.container.drawAll,formDraw:r.form.draw,formSubmit:r.form.submit,formReset:r.form.reset,Query:r.Query,visualization:r.visualization,datatable:r.datatable,prefix:function(e,n){return n!==t&&r.namespace.set(e,n),n!==t?this:r.namespace.get(e)},baseURL:function(e){return e!==t&&r.namespace.setBaseURL(e),e!==t?this:r.namespace.getBaseURL()||""},defaultQuery:function(e){return i("query",e,s,this)},defaultFroms:function(e){var t=i("froms",e,s,this);return t!==this&&(t=t.slice(0)),t},defaultEndpointURL:function(e){return i("endpoint",e,s,this)},defaultEndpointOutputFormat:function(e){return i("endpoint_output_format",e,s,this)},defaultEndpointResultsURLPart:function(e){return i("endpoint_results_urlpart",e,s,this)},defaultValidatorURL:function(e){return i("validator_url",e,s,this)},defaultLogContainer:function(e){return i("logcontainer",e,s,this)},defaultLogLevel:function(e){return i("loglevel",e,s,this)},defaultDatatableFunction:function(e){return i("datatable",e,s,this)},defaultChartFunction:function(e){return i("chart",e,s,this)},defaultChartHeight:function(e){return i("height",e,o,this)},defaultChartWidth:function(e){return i("width",e,o,this)},defaultChartSpecificOption:function(e,t,n){return r.defaults.setChartSpecificOption(e,t,n),this}},jQuery.ajaxSetup({cache:!0,accepts:{xml:"application/sparql-results+xml",json:"application/sparql-results+json",jsonp:"application/sparql-results+json"}})})(window);