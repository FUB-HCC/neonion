{% extends "base.html" %}

{% load staticfiles %}

{% block title %}My Annotations{% endblock %}
{% block page_id %}myAnnotations{% endblock %}


{% block content %}
    <div>
        <h3>My Annotations</h3>
        <span class="sorting">Sort By
            <select>
                <option>Name</option>
                <option>Date</option>
                <option>Concept</option>
                <option>Occurences</option>
            </select>
        </span>
        <ul id="annotation-table" class="document-grid">
            <li><span class="fa fa-spinner fa-spin"></span> Loading...</li>
        </ul>
    </div>
{% endblock %}


{% block scripts %}
<script language="javascript">
    "use strict";

    $(document).ready(function() {
        loadAnnotationList();
    });

    function compare_Documents(a,b) {
      if (a.createdAt < b.createdAt)
         return -1;
      if (a.createdAt > b.createdAt)
        return 1;
      return 0;
    }

    function loadAnnotationList() {
        var annotationList = [];

        // load annotation list
        // better replace this part by angular js
        $.getJSON("{% url 'store.views.filter_annotations' %}", function(response) {
            $.each(response.rows, function(index, value) {

                $("#annotation-table").append(
                    /* create element for document list and append it */
                    var uri = entry.urn.split("/")
                    var id = uri[uri.length - 1]
                    $('<li></li>')
                            .append($('<a href="/annotator/' + value['quote'] + '"><div>' +  value['quote'] + '</div></a>'));
                )
            }
            response.rows.forEach(function(index, value) {
                annotationList.push(index, value);
            });

            var today = moment().startOf("day");
            var todayLabelSet = false;
            var earlierLabelSet = false;
            $('#annotation-table').html('');

            if (annotationList.length > 0) {
                annotationList.sort(compare_Documents)
                .reverse()
                .forEach(function (entry) {
                    /* set label for first column (only once for each type) */
                    var label = '';
                    if (!todayLabelSet && entry.createdAt >= today) {
                        label = 'Today';
                        todayLabelSet = true;
                    }
                    if (!earlierLabelSet && entry.createdAt < today) {
                        label = 'Earlier';
                        earlierLabelSet = true;
                    }
                    /* create element for document list and append it */
                    var uri = entry.urn.split("/")
                    var id = uri[uri.length - 1]
                    var element = $('<li></li>')
                          .append($('<a href="/annotator/' + id + '"><div>' + entry.title + '</div></a>'));
                    $('#annotation-table').append(element);
                });
            }
            else {

            }
        });
    }

</script>
{% endblock %}